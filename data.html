<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>전국 시도별 인플루엔자 접종자 버블차트 (예시)</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; margin: 16px; background: #fbfbfd; color:#111; }
    h1 { font-size: 20px; margin-bottom: 6px; }
    p.small { margin-top:0; color:#555; font-size:13px; }
    .controls { display:flex; gap:8px; margin:12px 0 18px; align-items:center; flex-wrap:wrap; }
    button, select { padding:8px 12px; border-radius:8px; border:1px solid #ddd; background:white; cursor:pointer; }
    #wrap { max-width:1100px; margin:0 auto; }
    #chartBox { background:white; padding:16px; border-radius:12px; box-shadow:0 6px 20px rgba(20,20,50,0.06); }
    canvas { width:100% !important; height:480px !important; }
    table { width:100%; border-collapse:collapse; margin-top:14px; font-size:13px; }
    th, td { padding:8px 6px; text-align:left; border-bottom:1px solid #f0f0f0; }
    .meta { display:flex; gap:12px; align-items:center; color:#666; font-size:13px; margin-top:8px; flex-wrap:wrap; }
    .note { color:#a33; font-size:13px; margin-top:8px; }
  </style>
</head>
<body>
  <div id="wrap">
    <h1>전국 시도별 인플루엔자 접종자 수 — 버블차트 (예시)</h1>
    <p class="small">※ 아래 수치는 예시용 더미 데이터입니다. 실제 집계값으로 바꾸려면 코드의 <code>data</code> 배열을 수정하세요. (아래 교체 방법 참고)</p>

    <div class="controls">
      <label for="sort">정렬:</label>
      <select id="sort">
        <option value="none">기본(시도 입력 순서)</option>
        <option value="size_desc">접종자수 내림차순</option>
        <option value="size_asc">접종자수 오름차순</option>
        <option value="name_asc">이름 가나다</option>
      </select>

      <button id="reset">초기상태</button>
      <button id="download">PNG로 저장</button>

      <div style="flex:1"></div>
      <div class="meta">
        <div id="totalInfo">총 접종자(예시합계): —</div>
      </div>
    </div>

    <div id="chartBox">
      <canvas id="bubbleChart"></canvas>

      <!-- 간단한 표: 시도 / 접종자수 / 비율 -->
      <table id="dataTable" aria-live="polite">
        <thead>
          <tr><th>시도</th><th>접종자 수</th><th>총합 대비(%)</th></tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="note">참고: 실제 접종자 수를 사용하려면 아래 주석을 참고해 <code>data</code> 배열을 교체하세요.</div>
    </div>
  </div>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
  /* =========================
     ** 주요 데이터(예시) **
     실제 데이터를 사용하려면 이 배열만 교체하세요.
     형식: { region: "시도명", value: 숫자(접종자수, 정수) }
     예: { region: "서울특별시", value: 3200000 }
     ========================= */
  const data = [
    { region: "서울특별시", value: 3200000 },
    { region: "부산광역시", value: 520000 },
    { region: "대구광역시", value: 430000 },
    { region: "인천광역시", value: 740000 },
    { region: "광주광역시", value: 280000 },
    { region: "대전광역시", value: 260000 },
    { region: "울산광역시", value: 190000 },
    { region: "세종특별자치시", value: 60000 },
    { region: "경기도", value: 4800000 },
    { region: "강원도", value: 260000 },
    { region: "충청북도", value: 220000 },
    { region: "충청남도", value: 420000 },
    { region: "전라북도", value: 340000 },
    { region: "전라남도", value: 360000 },
    { region: "경상북도", value: 410000 },
    { region: "경상남도", value: 610000 },
    { region: "제주특별자치도", value: 130000 }
  ];

  // --- 내부 계산 및 차트 준비 ---
  const total = data.reduce((s,d)=>s+d.value,0);
  document.getElementById('totalInfo').textContent = `총(예시) 접종합계: ${total.toLocaleString()} 명`;

  // x 축 위치는 index 기반으로 고정(시각적으로 좌우로 퍼지게), y는 작은 랜덤 분산으로 겹침 완화
  function buildDataset(arr) {
    return arr.map((d,i)=>{
      // bubble radius scale: adjust multiplier to taste
      const minRadius = 6;
      const maxRadius = 70;
      // value to radius mapping (sqrt scale)
      const radius = Math.max(minRadius, Math.sqrt(d.value) * 0.14);
      return {
        x: i + 1, // x position
        y: (Math.sin(i*1.3) + 1)*5 + (Math.random()*2-1)*2, // small vertical jitter for visibility
        r: Math.min(maxRadius, radius),
        region: d.region,
        value: d.value
      };
    });
  }

  // initial sequence = data order
  let currentOrder = 'none';
  let activeData = JSON.parse(JSON.stringify(data));

  // create chart
  const ctx = document.getElementById('bubbleChart').getContext('2d');
  const chartConfig = {
    type: 'bubble',
    data: {
      datasets: [{
        label: '시도별 접종자(예시)',
        data: buildDataset(activeData),
        // backgroundColor, borderColor 생략해서 브라우저 기본으로(Chart.js 기본)
        hoverRadius: 10,
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          callbacks: {
            label: function(context) {
              const d = context.raw;
              const pct = (d.value/total*100).toFixed(2);
              return `${d.region}: ${d.value.toLocaleString()}명 (${pct}%)`;
            },
            title: function(){ return ''; }
          }
        }
      },
      scales: {
        x: {
          title: { display: false },
          ticks: {
            callback: function(val, index) {
              // show region name under corresponding x tick
              const idx = Math.round(val) - 1;
              if (idx >=0 && idx < activeData.length) return activeData[idx].region;
              return '';
            },
            maxRotation: 45,
            minRotation: 45,
            autoSkip: false
          },
          grid: { display: false },
          min: 0,
          max: activeData.length + 1
        },
        y: {
          display: false,
          min: -5,
          max: 25
        }
      },
      onClick: (evt, elements) => {
        if (elements.length) {
          const el = elements[0];
          const point = chart.data.datasets[el.datasetIndex].data[el.index];
          alert(`${point.region}\n접종자: ${point.value.toLocaleString()}명\n총합 대비: ${((point.value/total)*100).toFixed(2)}%`);
        }
      }
    }
  };

  const bubbleChart = new Chart(ctx, chartConfig);

  // render table
  function renderTable(arr) {
    const tbody = document.querySelector('#dataTable tbody');
    tbody.innerHTML = '';
    arr.forEach(d=>{
      const pct = (d.value/total*100);
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${d.region}</td><td>${d.value.toLocaleString()}</td><td>${pct.toFixed(2)}%</td>`;
      tbody.appendChild(tr);
    });
  }
  renderTable(activeData);

  // re-draw chart when order changes
  function updateChart(arr) {
    activeData = arr;
    bubbleChart.data.datasets[0].data = buildDataset(activeData);
    // update x axis max
    bubbleChart.options.scales.x.max = activeData.length + 1;
    bubbleChart.update();
    renderTable(activeData);
  }

  // sort controls
  document.getElementById('sort').addEventListener('change', (e)=>{
    const v = e.target.value;
    let arr = JSON.parse(JSON.stringify(data));
    if (v === 'size_desc') arr.sort((a,b)=>b.value - a.value);
    else if (v === 'size_asc') arr.sort((a,b)=>a.value - b.value);
    else if (v === 'name_asc') arr.sort((a,b)=> a.region.localeCompare(b.region, 'ko'));
    // none -> original order (as defined)
    updateChart(arr);
  });

  document.getElementById('reset').addEventListener('click', ()=>{
    document.getElementById('sort').value = 'none';
    updateChart(JSON.parse(JSON.stringify(data)));
  });

  // download PNG
  document.getElementById('download').addEventListener('click', ()=>{
    const link = document.createElement('a');
    link.href = document.getElementById('bubbleChart').toDataURL('image/png', 1);
    link.download = '시도별_인플루엔자_접종_버블차트.png';
    link.click();
  });

  // 초기 표시 (원본 순서)
  updateChart(JSON.parse(JSON.stringify(data)));

  // 접근성 향상: 키보드에서 포커스하면 툴팁 대신 테이블이 보이므로 키보드 사용자도 정보 획득 가능
  </script>
</body>
</html>
